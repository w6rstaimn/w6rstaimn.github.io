#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>

void logMessage(char *message) {
    FILE *fp;
    fp = fopen("/var/log/great_log.txt", "a");
    if (fp == NULL) {
        puts("Failed to open log file.");
    } else {
        fprintf(fp, "Log: %s\n", message);
        fclose(fp);
    }
}

void processData(char *data) {
    char buffer[264];
    
    // VULNERABILITY: Buffer overflow via strcpy
    strcpy(buffer, data);
    printf("Data processed: %s\n", buffer);
    logMessage(buffer);
}

int main(int argc, char **argv) {
    setuid(0);
    if (argc < 2) {
        printf("Usage: %s <data>\n", argv[0]);
        return 1;
    } else {
        puts("Processing data...");
        processData(argv[1]);
    }
    return 0;
}
